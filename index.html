<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mundo WebXR Completo</title>
</head>
<body style="margin: 0; overflow: hidden;">
  <script type="module">
    // Importamos módulos
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js';
    import { VRButton } from 'https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/webxr/VRButton.js';
    import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/loaders/GLTFLoader.js';
    import { Sky } from 'https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/objects/Sky.js';

    // Escena y configuración inicial
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87CEEB);
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 1.6, 3);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.xr.enabled = true;
    document.body.appendChild(renderer.domElement);

    // Botón VR
    document.body.appendChild(VRButton.createButton(renderer));

    // Suelo
    const planeGeometry = new THREE.PlaneGeometry(10, 10);
    const planeMaterial = new THREE.MeshStandardMaterial({ color: 0x7BC8A4 });
    const plane = new THREE.Mesh(planeGeometry, planeMaterial);
    plane.rotation.x = -Math.PI / 2;
    scene.add(plane);

    // Luz
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
    const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    directionalLight.position.set(5, 10, 7.5);
    scene.add(ambientLight, directionalLight);

    // Carga de modelo 3D
    const loader = new GLTFLoader();
    loader.load('https://model-path.glb', (gltf) => {
      const model = gltf.scene;
      model.position.set(0, 0, -3);
      scene.add(model);
    });

    // Esfera flotante (animada)
    const sphereGeometry = new THREE.SphereGeometry(0.5, 32, 32);
    const sphereMaterial = new THREE.MeshStandardMaterial({ color: 0xEF2D5E });
    const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
    sphere.position.set(0, 1.5, -2);
    scene.add(sphere);

    // Sonido ambiental
    const listener = new THREE.AudioListener();
    camera.add(listener);
    const sound = new THREE.Audio(listener);
    const audioLoader = new THREE.AudioLoader();
    audioLoader.load('https://sound-path.mp3', (buffer) => {
      sound.setBuffer(buffer);
      sound.setLoop(true);
      sound.setVolume(0.5);
      sound.play();
    });

    // Raycasting para interactividad
    const raycaster = new THREE.Raycaster();
    const pointer = new THREE.Vector2();
    function onPointerClick(event) {
      pointer.x = (event.clientX / window.innerWidth) * 2 - 1;
      pointer.y = -(event.clientY / window.innerHeight) * 2 + 1;
      raycaster.setFromCamera(pointer, camera);
      const intersects = raycaster.intersectObjects(scene.children);
      if (intersects.length > 0) {
        intersects[0].object.material.color.set(0xff0000);
      }
    }
    window.addEventListener('click', onPointerClick);

    // Cielo dinámico
    const sky = new Sky();
    sky.scale.setScalar(450000);
    scene.add(sky);
    const sun = new THREE.Vector3();
    function updateSun() {
      const theta = Math.PI * (0.5 - 0.25);
      const phi = 2 * Math.PI * (0.5 - 0.5);
      sun.x = Math.sin(phi) * Math.cos(theta);
      sun.y = Math.sin(theta);
      sun.z = Math.cos(phi) * Math.cos(theta);
      sky.material.uniforms.sunPosition.value.copy(sun);
    }
    updateSun();

    // Partículas
    const particleGeometry = new THREE.BufferGeometry();
    const particleCount = 500;
    const positions = new Float32Array(particleCount * 3);
    for (let i = 0; i < particleCount; i++) {
      positions[i * 3] = (Math.random() - 0.5) * 10;
      positions[i * 3 + 1] = Math.random() * 5;
      positions[i * 3 + 2] = (Math.random() - 0.5) * 10;
    }
    particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
    const particleMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.1 });
    const particles = new THREE.Points(particleGeometry, particleMaterial);
    scene.add(particles);

    // HUD
    const textGeometry = new THREE.TextGeometry('¡Hola VR!', {
      font: new THREE.FontLoader().parse('path-to-font.json'),
      size: 0.5,
      height: 0.1,
    });
    const textMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff });
    const textMesh = new THREE.Mesh(textGeometry, textMaterial);
    textMesh.position.set(0, 2, -2);
    scene.add(textMesh);

    // Animación principal
    let angle = 0;
    function animateSphere() {
      angle += 0.01;
      sphere.position.y = 1.5 + Math.sin(angle) * 0.5;
    }

    function animate() {
      renderer.setAnimationLoop(() => {
        animateSphere();
        renderer.render(scene, camera);
      });
    }

    // Ajuste de ventana
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    animate();
  </script>
</body>
</html>
